# download, build, and install racket
- name: racket ping test
  ping:
  
- name: check if we have downloaded racket v8
  stat:
    path: '{{ racket["build_dir"] }}/{{ racket["tgz"] }}'
  register: tgz

- name: create build directory
  ansible.builtin.file:
    path: '{{ racket["build_dir"] }}'
    state: directory

- name: pull v8 for build
  get_url:
    url: '{{ racket["url"] }}/{{ racket["tgz"] }}'
    dest: '{{ racket["build_dir"] }}'
  when: tgz.stat.exists is defined and not tgz.stat.exists

- name: decompress
  ansible.builtin.unarchive: 
    src: '{{ racket["build_dir"] }}/{{ racket["tgz"] }}'
    dest: '{{ racket["build_dir"] }}'

- name: create a destination directory
  ansible.builtin.file:
    path: /opt/racket
    state: directory
    owner: pi
    group: pi
    mode: u=rwx,g=rx,o=rx
  become: yes

- name: configure
  command: 
    cmd: ./configure --prefix '{{ racket["install_path"] }}'
    chdir: '{{ racket["build_dir"] }}/{{ racket["src"] }}'

- name: make and install
  command:
    cmd: make install CPUS=4
    chdir: '{{ racket["build_dir"] }}/{{ racket["src"] }}'
