- name: checkout session-counter
  ansible.builtin.git:
    repo: '{{ sc["repos"] }}'
    dest: '{{ sc["src"] }}'
    update: yes
    version: '{{ sc["branch"] }}'

- name: compile session-counter
  ansible.builtin.command:
    cmd: '{{ racket["raco"] }} exe -o session-counter session-counter.rkt'
    chdir: '{{ sc["src"] }}'

- name: prep for dist
  ansible.builtin.command:
    cmd: '{{ racket["raco"] }} distribute {{ dist["src"] }}/session-counter/ session-counter'
    chdir: '{{ sc["src"] }}'

- name: copy in manufacturer db
  ansible.builtin.copy:
    src: '{{ sc["src"] }}/manufacturers.sqlite'
    dest: '{{ dist["src"] }}/session-counter/manufacturers.sqlite'

- name: archive the app for distribution
  archive:
    path: '/tmp/session-counter'
    dest: '{{ dist["src"] }}/session-counter/session-counter.tgz'
